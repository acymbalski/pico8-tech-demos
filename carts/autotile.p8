pico-8 cartridge -- http:--www.pico-8.com
version 16
__lua__
-- autotiler
-- by andy

-- holds cursor information
cursor = {}

-- amount to shift color, for fun
shiftval = 1

-- create new tile
function ntile(x, y, initial)

    -- if the current tile is blank, or if it's being modified from a different tile, then update it
    if flr(mget(x, y)/16) == 0 or not initial then

        -- "tile code" - was initially a 4 character string but there was a better way using numbers
        tcode = 0
        
        -- essentially create a binary value wxyz, where values are 0 or 1 depending on whether adjacent tiles (up right down left) are empty
        tcode += flr(mget(x, y-1)/16) * 8
        tcode += flr(mget(x+1, y)/16) * 4
        tcode += flr(mget(x, y+1)/16) * 2
        tcode += flr(mget(x-1, y)/16) * 1
        
        -- add 16 to that number (sprite sheet offset I picked) and add that tile to the map at the correct location
        mset(x, y, tcode+16)
        
    -- if this tile is already filled, blank it
    elseif flr(mget(x, y)/16) == 1 then
        mset(x, y, 0)
    end
    
    
    -- if this tile is not being modified by its neighbors, update its neighbors to reflect the tile change
    if initial then
        if flr(mget(x, y-1)/16) == 1 then ntile(x, y-1, false) end
        if flr(mget(x+1, y)/16) == 1 then ntile(x+1, y, false) end
        if flr(mget(x, y+1)/16) == 1 then ntile(x, y+1, false) end
        if flr(mget(x-1, y)/16) == 1 then ntile(x-1, y, false) end
    end

end

-- reset screen back to default state
function reset()

    -- reset color shifts to default
    pal()
    
    -- reset cursor position
    cursor.x = 8
    cursor.y = 8
    
    -- blank map
    for i=0,32 do
        for j=0,32 do
            mset(i, j, 0)
        end
    end
    
end

-- called by program to initialize variables
function _init()

    -- initialize cursor in the center of the map
    cursor.x = 8
    cursor.y = 8
    -- set cursor sprite
    cursor.spr = 1
    
    -- add option to "enter" menu to clear the screen
    menuitem(1, "clear screen", function() reset() end)
    
    -- does this work? set cart label
    extcmd("label", "autotiler")
    
    
end

-- called by program to draw sprites
function _draw()

    -- clear screen for redraw
    cls()
    
    -- move camera to center the cursor (sprites are 8 pixels wide)
    camera(cursor.x * 8 - 60, cursor.y * 8 - 60)
    
    -- draw boundary lines
    line(0, 0, 16 * 8, 0, 8)
    line(0, 0, 0, 16 * 8, 8)
    line(16 * 8, 0, 16 * 8, 16 * 8, 8)
    line(0, 16 * 8, 16 * 8, 16 * 8, 8)
    
    -- draw the things that we've added to the map
    map(0,0,0,0,16,16)

    -- draw the cursor, translate x and y (in grid values) to pixels
    spr(cursor.spr, cursor.x * 8, cursor.y * 8)
    
end

-- called by program to update variables
function _update()

    -- control cursor (left right up down)
    if (btnp(0)) then cursor.x -= 1 end
    if (btnp(1)) then cursor.x += 1 end
    if (btnp(2)) then cursor.y -= 1 end
    if (btnp(3)) then cursor.y += 1 end
    
    -- if button z is pressed, create new tile
    if btnp(4) then ntile(cursor.x, cursor.y, true) end
    
    -- if button x is pressed, cycle color schemes for fun
    if btnp(5) then
        
        -- 16 colors, but 0 is black/transparant
        for c=1,15 do
            nc = c + shiftval
            -- if the color to shift to does not exist, loop to the beginning of the palette
            if nc > 15 then nc -= 15 end
            
            -- redraw color 'c' as color 'nc' in subsequent calls
            pal(c, nc)
        end
        
        -- increment shiftval so we can get new colors next time
        shiftval += 1
        
        -- if shiftval is too high, loop back to the beginning
        if shiftval > 15 then shiftval = 1 end
        
    end
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700066006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700066006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444440444444400444444044444440044444444444444404444444444444444333333433333334433333343333333443333333333333334333333333333333
44333344333333444433334433333344443333333333333344333333333333334333333433333334433333343333333443333333333333334333333333333333
43333334333333344333333433333334433333333333333343333333333333334333333433333334433333343333333443333333333333334333333333333333
43333334333333344333333433333334433333333333333343333333333333334333333433333334433333343333333443333333333333334333333333333333
43333334333333344333333433333334433333333333333343333333333333334333333433333334433333343333333443333333333333334333333333333333
43333334333333344333333433333334433333333333333343333333333333334333333433333334433333343333333443333333333333334333333333333333
44333344333333444333333433333334443333333333333343333333333333334433334433333344433333343333333444333333333333334333333333333333
04444440444444404333333433333334044444444444444443333333333333330444444044444440433333343333333404444444444444444333333333333333
__label__
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000044444444444444444444440000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000443333333333333333333344000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333334000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333334000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333334000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333334000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333334000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333334000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333444444400000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333440000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333340000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333340000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333340000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333340000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333340000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333340000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333334444444000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333334400000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333400000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333400000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333400000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333400000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333400000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333400000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333344444440000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333344000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333344000000000000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333444444443333333344444440000000000000000000000000000000000000
00008000000000000000000000000444444444444444333333333333333333333334000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000004433333333333333333333333333333333333334000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000004333333333333333333333333333333333333334000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000004333333333333333333333333333333333333334000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000004333333333333333333333333333333333333334000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000004333333333333333333333333333333333333334000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000004433333333333333333333333333333333333344000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000000444444433333333333333334444444444444440000000004333333400000000000000000000000000000000000000000000
00008000000000000000000000000000000043333333333333340000000000000000044444443333333400000000000000000444444000000000000000000000
00008000000000000000000000000000000043333333333333340000000000600600443333333333333400000000000000004433334400000000000000000000
00008000000000000000000000000000000043333333333333340000000006600660433333333333333400000000000000004333333400000000000000000000
00008000000000000000000000000000000043333333333333340000000000000000433333333333333400000000000000004333333400000000000000000000
00008000000000000000000000000000000043333333333333340000000000000000433333333333333400000000000000004333333400000000000000000000
00008000000000000000000000000000000043333333333333340000000006600660433333333333333400000000000000004333333400000000000000000000
00008000000000000000000000000000000044333333333333340000000000600600443333333333333400000000000000004333333400000000000000000000
00008000000000000000000000000000000004444444333333340000000000000000044444443333333400000000000000004333333400000000000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000044444443333333344444440000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000443333333333333333333344000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000433333333333333333333334000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000433333333333333333333334000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000433333333333333333333334000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000433333333333333333333334000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000433333333333333333333344000000000000
00008000000000000000000000000000000000000000433333340000000000000000000000004333333400000000433333333333333344444440000000000000
00008000000000000000000000000000000000000000433333340000000004444444444444443333333344444444333333333333333400000000000000000000
00008000000000000000000000000000000000000000433333340000000044333333333333333333333333333333333333333333333400000000000000000000
00008000000000000000000000000000000000000000433333340000000043333333333333333333333333333333333333333333333400000000000000000000
00008000000000000000000000000000000000000000433333340000000043333333333333333333333333333333333333333333333400000000000000000000
00008000000000000000000000000000000000000000433333340000000043333333333333333333333333333333333333333333333400000000000000000000
00008000000000000000000000000000000000000000433333340000000043333333333333333333333333333333333333333333333400000000000000000000
00008000000000000000000000000000000000000000433333340000000043333333333333333333333333333333333333333333334400000000000000000000
00008000000000000000000000000000000000000000433333340000000043333333333333333333333333333333333333334444444000000000000000000000
00008000000000000000000000000000000000000000433333334444444433333333333333333333333333333333333333340000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333333333333340000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333333333333340000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333333333333340000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333333333333340000000000000000000000000000
00008000000000000000000000000000000000000000433333333333333333333333333333333333333333333333333333340000000000000000000000000000
00008000000000000000000000000000000000000000443333333333333333333333333333333333333333333333333333440000000000000000000000000000
00008000000000000000000000000000000000000000044444444444444433333333333333333333333333333333444444400000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000043333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000043333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000043333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000043333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000043333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000043333333333333333333333333333334000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000044333333333333333333333333333344000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000004444444444444444444444444444440000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

